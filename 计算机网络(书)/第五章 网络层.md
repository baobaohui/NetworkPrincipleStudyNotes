# 第五章 网络层
## 5.1 网络层与IP协议
### 5.1.1 网络层基本概念
    
    网络层通过路由选择算法，为IP分组从源主机到目的主机选择一条合适的传输路径，为传输层提供端-端数据传输服务
    
### 5.1.2 IPv4协议的基本内容
1，IPv4协议研究的背景
    
    
2，IPv4协议发展与演变
    
详请见图 5.1 IPv4 协议的研究与发展的过程示意图

## 5.2 IPv4协议的基本内容
### 5.2.1 IP协议的主要特点
1，IP协议是一种无连接、不可靠的分组传送服务的协议
    
    无连接(connectionless):IP协议并不能维护IP分组发送后的任何状态信息。每个分组的传输过程是相互独立的
    不可靠(unreliable):IP协议不能保证每个IP分组都能正确地、不丢失和顺序的达到目的
    
2，IP协议是点-点的网络层通信协议
    
    网络层需要在Internet中为通信的两个主机之间寻找一条路径，而这条路径通常是由多个路由器、点-点链路组成
3，IP协议屏蔽了互联的网络在数据链路层、物理层协议与实现技术上的差别
    
### 5.2.2 IPv4分组格式
1，IPv4 分组结构
    
    
    IPv4分组的结构：
            0       4           8           16       19      24      31
    固定    |版本  |  分组头长度 | 服务类型 |         总长度          |
    长      |           标识                |标志   |   片偏移        |     分
    度      |生存时间     |       协议      |         头部检验和      |     组
    部      |                            源IP地址                     |     头
    分      |                          目的地IP地址                   |
    可选部分|               选项                        |   填充域    |
            |                       数据部分                          | 数据部分
2，IPv4分组头格式
    
    版本：4,6 版本号
    
    分组头长度：字段最小值5(5*4B=20B)
    
    区分服务(DS):D(延迟),T(吞吐量),R(可靠性),C(成本)
    
    总长度:以字节为单位的分组头字段与数据字段之和
    
    生存时间(time-to-live,TTL)：表示分组在Internet中的寿命，用转发分组最多的路由器跳数(hop)来度量
    
    协议：使用IP协议的高层协议类型

协议字段值 | 高层协议类型
---|---
1 | ICMP
2 | IGMP
6 | TCP
8 | EGP
17 | UDP
41 | IPv6
89 | OSPF
    
    头检验和:保证分组头部的数据完整性
    
    地址：包括源地址与目的地址
3，IP分组的分片与组装
    
    不同网络的数据链路层的MTU的长度可能不同，所以封装成帧的数据可能需要分片才能
    更好的进行传输
    
详情见图 5.4 IP分组的分片过程示意图

4，IP分组头选项
    
    设置IP分组头选项的目的：最大长度40字节
    源路由：发送分组的源主机制定的传输路径
        严格源路由
        松散源路由
    记录路由：将分组经过的每个路由器IP地址记录下来
    时间戳：记录分组经过每个路由器的本地时间

5，校验和计算方法
    
详情见图 5.6 校验和计算过程的示例

## 5.3 IPv4 地址
### 5.3.1 IP地址的基本概念
2，IPv4 地址技术发展的4个阶段
    
    第一个阶段：标准分类的IP地址
        A类地址：125个
        B类地址：16384个
        C类地址
        
    第二个阶段：划分子网的三级地址结构
        子网(subnet)，掩码(mask)
        
    第三个阶段：构成超网的无类别域间技术
        无类别域间路由(classless inter domain routing,CIDR)，将剩余的IP地址按可变大小的地址块来分配
        
    第四个阶段：网络地址转换NAT技术
        IP地址短缺，而Internet网络迁移到IPv6的进程缓慢，我们需要一个短时期内快速缓解地址短缺的方法
### 5.3.2 标准分类IP地址
1，网络地址的基本概念
    
    名字name，地址address，路径route
        我是谁，我在哪，怎么找到我
        
    MAC地址与IP地址
        每台计算机都有一个物理地址--MAC
        IP地址--网络层的地址，主要用于路由器的寻址，IP地址采用层次结构，可变
    
    IP地址与网络接口
        IP地址：标识的是一台主机或路由器与网络的接口
        
    IP地址的分配方法
        为每一个网络接口分配一个IP地址
        为多归属主机的每一个网络接口分配相应的IP地址
        可以为一个网络接口分配多个IP地址
2，IP地址的点分十进制的表示方法
    
    
    标准分类的IP地址
       -                                                          主机地址范围
            1               8           16          24          32          
                
    A类地址|0|网络号(7)位|             主机号(24位)            |1.0.0.0~
                                                                127.255.255.255
    B类地址|10|    网络号(14位)        |       主机号(16位)    |128.0.0.0~
                                                                191.255.255.255
    C类地址|110|       网络号(21位)                |主机号(8位)|192.0.0.0~
                                                                223.255.255.255
    D类地址|1110|                  多播地址(28位)              |224.0.0.0~
                                                                239.255.255.255
    E类地址|11110|             保留用于实验和将来使用          |240.0.0.0~
                                                                247.255.255.255

3，标准IP地址的分类
    
    A类地址：可分配网络号：127-2=125块；主机号：2的24次方-2=16777214个
    B类地址：可分配网络号：2的14次方=16384个；主机号：2的16次方=65535个
    C类地址：可分配网络号：2的21次方=2097152个；主机号：2的8次方=256个
    D类地址：其他特殊用途，如：多播地址
    E类地址：暂时保留
4，特殊地址形式
    
    直接广播(directed broadcasting)地址
        在A类B类C类中，若主机号是全1(如，192.1.255)，则为该地址
        
    受限广播(limited broadcasting)地址
        32位网络号与主机号为全1的IP地址(255.255.255.255)
        
    “这个网络上特定主机”地址
        在A类B类C类中，若网络号是全0(如，192.1.255)，则为该地址
        路由器接到这样的分组时，不向外转发该分组，而是直接交付给本网络中主机号为25的主机
        
    回送地址(lookback address)
        A类IP地址中127.0.0.0是回送地址，是一个保留地址
        用于网络软件测试和本地进程间通信
    
5，专用IP地址


类| 网络号 | 总数
---|--- | --
A | 10. | 1
B | 172.16~172.31 | 16
C | 192.168.0~192.168.255 | 256

### 5.3.3 划分子网的三级地址结构
1，子网的概念
    
    借用主机号的一部分作为子网的子网号，划分出更多的子网IP地址，而对于外部路由器的寻址没有影响
2，划分子网的地址结构
    
    三级层次的结构：net ID-subnet ID-host ID,增加了一级子网号
3，子网掩码的概念
    
    从IP地址中提取子网号
    
详情见图 5.10 标准A类、B类或C类地址掩码

5.11 一个B类地址划分为64个子网的例子

4，子网规划与地址空间划分的基本方法
    
    子网地址与主机号不能使用全0或全1
    
5，可变长度子网掩码(variable length subnet masking,VLSM)技术

### 5.3.4 无类别域间路由
    
    无类别域间路由(CIDR),将剩余的IP地址按可变大小的地址块来分配，采用“斜线记法”
    
    使用CIDR进行地址块的划分
### 5.3.5 网络地址转换
1，网络地址转换的基本概念
    
    IP地址短缺，而Internet网络迁移到IPv6的进程缓慢，我们需要一个短时期内快速缓解地址短缺的方法
    
    动态NAT 与 静态 NAT
    
    NAT 与 NAPT
2，网络地址转换的工作原理
    
    
## 5.4 路由选择算法与分组交付
### 5.4.1 分组交付和路由选择的基本概念
1，分组交付的基本概念

    默认路由器的概念
        分组交付(forwarding)是指在Internet中主机，路由器转发IP分组的过程
    
    直接交付和间接交付的概念
        路由器需要根据分组的目的地址与源地址是否属于同一个网络，判断是直接交付还是间接交付
        
2，评价路由选择的依据
    
    分组交付的路径由路由选择算法(routing algorithm)决定
    算法要能够适应网络拓扑和通信量的变化

3，路由选择算法的主要参数
    
    跳数(hop count)：一个分组从源主机到达目的主机的路径上，转发分组的路由器数量
    带宽(bandwidth)：链路的传输速率
    延时(delay)：指一个分组从源主机到达目的主机花费的时间
    负载(load)：指通过路由器或线路的单位时间通信量
    可靠性(reliability)：指传输过程中的分组丢失率
    开销(overhead)：传输过程中的耗费

4，路由选择算法的分类
    
    静态路由表
    动态路由表
        自动更新路由器中路由表
        
5，路由表的生成与使用
    
    Internet中每台路由器中都会保存一个路由表，路由选择是通过表驱动的方式进行的
    
    
    
详情见图 5.18 路由表的生成与使用
 
6，IP路由汇聚
    
    路由器的路由表项数量越少，路由选择查询的时间就越短，通过路由器转发分组的延迟时间也就越少，
    路由汇聚是减少路由表数量的重要手段之一
    
    路由表项由 网络前缀+下一跳地址
    

### 5.4.2 路由表的建立、更新与路由选择协议
    
    路由选择算法：生成路由表，为路由器转发IP分组找出适当的下一跳路由器
    路由选择协议：实现路由表中路由信息的动态更新
    
    自治系统(autonomous system,AS):路由选择的自治
    
        
    
    Internet路由选择协议的分类
        内部网关协议(Interior Gateway Protocol,IGP)
            路由信息协议(Routing Information Protocol,RIP)
            
            开放最短路径优先(open shortest path first,OSPF)
        外部网关协议(External Gateway Protocol,EGP)
        
        
    
### 5.4.3 路由信息协议
    
    路由信息协议(RIP)基于距离向量路由选择算法的内部路由协议。

1，距离向量路由选择算法
    
    要求路由器周期性地通知相邻路由器：自己可以到达的网络，以及到达该网络的距离
    
    路由刷新报文主要内容是由若干(V,D)组成的表
    V：代表向量(vector),标识该路由器可以到达的目的网络或目的主机
    D：代表距离(distance),指出该路由器到达目的网络或目的主机的距离，跳数

2，距离向量路由协议的工作原理
    
    路由信息更新方法
        路由表建立后，路由器周期性地向相邻路由器广播自己路由表的(V,D)信息
        相邻路由表判断路径长短进行重新设置
    
    路由表更新过程
    
    路由信息协议
        周期更新定时器：RIP为每个路由表项设置一个周期更新定时器，定时向相邻路由器广播
        延时定时器：为防止出现因更新而出现的广播风波，为每次更新设置一个延迟定时器
        超时定时器：某条路径出现路障，不立即删除
        清除定时器：某一项路由记录置为无效超过一定时间，删除


### 5.4.4 最短路径优先协议
1，最短路径优先协议的主要特点
    
    最短路径优先协议(open shortest path first,OSPF)
    
    OSPF 使用的是链路状态协议(LSP)，RIP使用的是距离向量路由选择协议
    OSPF 使得区域内的所有路由器最终都能形成一个跟踪网络链路状态变化的链路状态数据库
    
2，OSPF 主干区域与区域的概念

3，OSPF 协议的分组类型
    
    问候分组
    数据库描述分组
    链路状态请求分组
    链路状态更新分组
    链路状态确认分组

4，OSPF 协议执行过程
    
    确定相邻路由器“可达”
    链路状态数据库同步
    链路状态更新

详情见图 5.23 OSPF 协议执行过程
    
### 5.4.5 外部网关协议

    外部网关协议：边界网关协议(BGP)
    BGP是运行在自治系统之间唯一的一种IP路由协议
1，外部网关协议的基本设计思想
    
    配置BGP时，每个自治系统的管理员要选择至少一个路由器(通常是BGP边界路由器)作为
    该自治系统的“BGP发言人”，和别的BGP发言人交换路由信息
    
    BGP发言人互相交换了网络可达性的信息之后，各BGP发言人就根据所采用的策略，从接
    到的路由信息中找出格子自治系统的最佳路由
    
    

2，BGP路由选择协议的工作过程

    BGP边界路由器初始化过程
    BGP路由选择协议的分组
        打开分组
        更新分组
        保活分组
        通知分组
### 5.4.6 路由器与第三层交换技术
1，路由器主要功能
    
    建立并维护路由表
    提供网络间的分组转发功能
    
2，路由器结构与工作原理

详情见图 5.30 典型的路由器结构示意图

## 5.5 Internet 控制报文协议
### 5.5.1 Internet控制报文协议(ICMP)的作用与特点
    
    IP协议提供的是尽力而为的服务
    
    ICMP协议的特点
        
        作为网络层协议，但是报文，封装成IP分组，再传送给数据链路层
        解决IP协议不可靠问题
    
    ICMP报文结构

详情见图 5.36 ICMP报文结构


### 5.5.2 ICMP报文类型
1，ICMP差错控制报文
    
    目的主机不可达(destination unreachable)
        网络不可达(net unreachable):代码0表示
        主机不可达(host unreachable):代码1表示
        协议不可达(protocol unreachable):代码2表示
        端口不可达(port unreachable):代码3表示
        源路由选择不能完成(source route failed)：代码4表示
        目的网络不可知(unknown destination network):代码5表示
        目的主机不可知(unknown destination Host):代码7表示
        
    源主机抑制(source quench)
        “源抑制”是当路由器或主机因拥塞而丢弃一个分组时，就像源主机发送源抑制报文
        
    超时
        IP采用两种措施解决超时问题：
            一是在分组的报头中设置生存时间TTL字段
            二是对分片采用定时器技术
            
    重定向报文
        实现主机路由表的更新
        
    参数问题报文
        如IP分组头中任何一个字段的参数丢失或出错，路由器或目的主机在丢弃该分组
        后，向源主机发送“参数问题报文”
2，ICMP查询报文
    
    为网络故障诊断的目的而设计，ICMP差错控制报文是单向的，ICMP查询报文是双向的
    
    回请请求和应答
    时间戳请求和应答
    地址掩码请求
### 5.5.3 Ping与Traceroute命令
1，Ping 命令的使用
    
    Ping 是测试目的主机是否能够到达的一种通用方法
    用户调用ping命令便是通过回应请求(ICMP echo request)和应答报文(ICMP echo reply)，
    检查和检测目的主机或路由器是否能够到达
2，Tracert 命令的应用
    
    Tracert 命令可以获得从测试命令发出的源主机到达目的主机完整的路径，因此也被称为“路由跟踪”命令
    
详情见图 5.40 Tracert 工作原理示意图
## 5.6 IP多播与IGMP协议
### 5.6.1 IP多播的基本概念

    
    IP多播协议(Internet Group Management Protocol,IGMP)
IP多播与单播的协议
    
    单播：主机准备多份副本，分别封装在源地址相同而目的地址不同的20个分组中，
            分别将这20个分组发给20个目的主机
    
    多播：主机准备一个副本，封装在一个多播分组中，发送给多播分组中20个多播组成员
    
    支持IGMP协议的路由器称为多播路由器
### 5.6.2 IP多播地址
    
    IP多播分为两类：在Internet范围内进行多播；在局域网内进行多播(路由器)
    
    IP多播地址的特点
        实现IP多播的分组使用的是IP多播地址，IP多播地址只能用于目的地址，而不能用于源地址(组播路由器)
        
        标准分类的D类地址是为IP多播地址定义的
        
        
        IP多播地址分为两类：永久多播地址与临时多播地址
    
    Ethernet(以太网)硬件多播地址的特点
        
### 5.6.3 IGMP协议的基本内容
1，IP多播的实现方法
    
    IP多播思想：多个接受最好者可以接受到从同一个或一组源主机一次发送的相同内容的分组
    工作模式：
        定义一个组地址(group address),每个组代表一个或多个发送者与一个
            或多个接受者的一个会话(session)
        
        接受者可以用多播地址通知路由器，他希望加入(退出)哪个多播组
        发送者使用多播地址发送分组，无需了解接受者的位置信息与状态信息
        路由器建立一颗从发送者分支出去的多播传递树，路由器把多播分组转发到有多播
            组成员的网络中
2，IGMP协议的操作
    
    加入一个组
    继续组成员关系
    监视组成员的关系
    离开一个组
    
### 5.6.4 多播路由器与IP多播中的隧道技术
1，多播路由器
    
        完成多播分组的转发工作，具体有两种实现方式：一种是专用多播路由器，另一种
    是在传统路由器上实现多播路由的功能
2，IP多播中的隧道技术
    
    当IP多播分组在传输的过程中遇到有不支持多播协议的路由器或网络时，就要采用隧道技术
    
    网络1                               网络2
                不支持多播的网络
    路由器1  《=========隧道===========》 路由器2
                    
    
    网络1和网络2中的多播数据报：    |头部|数据|
    隧道中传输的单播数据报 ：   头部|数据
    
## 5.7 MPLS 协议
### 5.7.1 资源预留协议与区分服务
    
        QoS(服务质量)保障机制实际上是一种网络资源分配机制，在讨论IP网络的QoS问
    题时出现了资源预留协议(Resource Reservation Protocol,RSVP),
    区分服务(differentiated services,DiffServ)与多协议标识服务技术
1，RSVP的基本概念

    资源预留协议的核心是对一个应用会话的数据流提供服务质量保证。
    设计思想：源主机和目的主机会在会话之前建立一个链接，路径上的所有路由器都要
                预留出此次会话所需要的带宽与缓冲区资源
2，DiffServ的基本概念
    
    RSVP是基于某一个会话流，而DiffServ是基于某一类应用的
    RSVP要求所有的路由器都要修改软件，以支持基于流的传输服务
    
### 5.7.2 多协议标识交换
1，MPLS的基本概念
    
    MPLS(多协议标识交换技术)将数据链路层的第二层交换技术引入网络层，实现快速IP分组交换。
    核心网络是MPLS域，构成它的路由器是标识交换路由器(label switching router,LSR)
    
    MPLS提供的服务功能：
        提供面向连接与QoS的服务
        合理利用网络资源
        支持虚拟专用服务
        支持多协议
        
2，MPLS的基本工作原理        
    
    标记交换路由器LSR和边界路由器E-LSP。由LSR组成，实现MPLS功能的网络区域称为
    MPLS域(MPLS domain)
    
    路由和交换的区别
    
    MPLS工作原理
        标记分配协议(Label Distribution Protocol,LDP)交换报文
    
详情见图 5.45 MPLS的基本工作原理示意图
### 5.7.3 MPLS VPN的应用
1，VPN的基本概念
    
    VPN (虚拟专网)是指在公共传输网络中建立虚拟的专用数据传输通道，将分布在不同
    地理位置的网络或主机连接起来，提供安全的端-端数据传输服务的网络技术。
    
    “虚拟”表示VPN是在公共传输网络中，通过建立隧道或虚电路的方式建立的一种“逻辑”
    的覆盖网
    “专用”表示VPN可以为接入的网络与主机，提供保证服务质量(QoS)与安全的传输服务
    
2，VPN的实现方法
    
    租用线路或在ATM网，帧中继网组件VPN
    
    MPLS VPN
        服务提供商为每个VPN分配一个路由标识符(RD),借此在独立工作的网络中进行通信
        保证数据通信安全，网络服务质量的要求，操作方便，具有很好的扩展性

## 5.8 地址解析协议
### 5.8.1 IP地址与物理地址的映射

    IP地址-MAC地址映射表，静态映射
    
### 5.8.2 地址解析工作过程
1，地址解析的基本工作过程
    
        从已知的IP地址找出对应的MAC地址的映射过程称为正向地址解析，相应的协议
    称为地址解析协议(Address Resolution Protocol,ARP)
      从已知的MAC地址找出对应的IP地址映射过程称为反向地址解析(Reverse ARP,RARP)
     
    地址解析协议与IP地址/MAC地址关系示意图
    
    应用层      |     进程    |
    传输层      | TCP ||UDP   |   ->  端口号
    网络层      |     IP      |   ->  IP地址    -->
    数据链路层  | 底层物理网络|   ->  MAC地址   --> ARP/RARP  
    
    同一个网络中的主机之间的地址解析的基本工作过程如下：
    
    封装了源主机IP地址，MAC地址的经过数据链路层组装成的ARP请求分组的帧通过广播的
    形式发出去，没有它地址的一些主机会存下IP，MAC到映射表中，目的主机收到后通过
    单播形式发送封装了“ARP应答分组”的帧到源主机，源主机将目的主机的IP地址，MAC
    地址存在映射表中
    
    
详情见图    5.49 ARP执行过程示意图
    
3，ARP服务的4种情况
    
    主机需要解析在同一个网络的主机的MAC地址
    主机需要解析不再同一个网络的主机的MAC地址
    路由器需要解析下一跳路由器的MAC地址
    路由器需要解析同一个网络的主机MAC地址

详情见图 5.50 ARP协议的4种情况
## 5.9 移动IP协议
### 5.9.1 移动IP协议的基本概念
    
    手机等移动端的兴起使得移动IP成为热点，每台主机都需要分配一个IP地址，而鉴于
    手机会在不同子网之间移动，所以如何设置移动端IP地址成为问题，后来推出移动IPv4
    协议
### 5.9.2 移动IP协议的设计目标与主要特征
1，移动IP的设计目标
    
    移动主机在改变接入点时，无论是在不同的网络之间，还是在不同的物理传输介质之间
    移动时，都不必改变其IP地址，可以在移动过程中保持已有通信的连续性。
2，移动IP协议的基本特性
    
    与现有Internet协议兼容
    与底层所采用的的物理传输介质类型无关
    对传输层及以上的高层协议是透明的
    具有良好的扩展性，可靠性，安全性

    
### 5.9.3 移动IP协议的结构与基本术语
1，移动IP的结构

    移动结点
        从一个链路移动到另一个链路的主机或路由器，改变网络接口后，IP地址不变，也可与其他结点通信
    
    家乡代理
        移动结点的家乡网络连接到Internet的路由器
        
    外地代理
        指移动结点所访问的外地网络连接到Internet的路由器
        
    通信对端
        指移动结点在移动过程中与之通信的结点(固定结点、移动结点)
    
2，移动IP的基本术语
    
    家乡地址(home address)：家乡网络为每个移动结点分配的一个长期有效的IP地址
    转交地址(care-of address)：当移动结点接入一个外地网络时，被分配的一个临时IP地址
    家乡网络(home network)：指为移动结点接入一个外地网络时，被分配的一个临时的IP地址
    家乡链路(home link)：指移动结点在家乡网络时接入的本地链路
    外地链路(foreign link)：指移动结点在访问外地网络时接入的链路
    移动绑定(mobility binding)：家乡网络维护移动结点时的家乡地址与转发地址的关联
    隧道(tunnel)：家乡代理通过隧道发送给移动结点的IP分组转发到移动结点
### 5.9.4 移动IPv4协议的基本工作原理
1，代理发现(agent discovery)
        
        定义“代理通告”，“代理请求”两种新的报文
    
2，注册(registration)
    
    注册概念
    注册过程
3，分组路由

    单播分组路由
        移动结点接收单播分组
        移动结点发送单播分组
        
    广播分组路由
    多播分组路由    
        移动结点接收多播分组
        移动主机发送多播分组
4，注销
    
    如果移动结点已经回到家乡网络，则它需要家乡代理进行注销   
    
### 5.9.5 移动IPv4协议中移动结点和结点主机的基本操作

详情见图 5.60 移动IPv4协议中移动结点与通信结点的基本操作

## 5.10 IPv6协议
### 5.10.1 IPv6协议的基本概念
    
    Internet技术快速发展，IPv4协议中诸多问题无法解决，提出下一代Internet网络IPv6
    协议
### 5.10.2 IPv6协议的基本特征
    
    新的协议头格式
    巨大的地址空间
    有效的分级寻址和路由结构
    有状态和无状态的地址自动配置
    内置的安全性
    更好的支持QoS
    用新协议处理邻主机的交互
    可扩展性
     
### 5.10.3 IPv6地址
1，IPv6地址表示法
    
    IPv6的128位地址按每16位划分为一个位段，每个位段被转换为一个4位的十六进制数，
    并用冒号隔开，这种表示法称为“冒号十六进制表示法“
2，零压缩法
    
    零压缩的基本规则
        21DA:0000:0000:0000:02AA:000F:FE08:9C5A
        21DA:0:0:0:2AA:F:FE08:9C5A
    
    双冒号表示法(double colon)
        FF02:30:0:0:0:0:0:0:5
        FF02:30::5
        
        共有 (8-3)*16=80 位二进制数字0 被压缩
        
3，IPv6前缀
    
    地址/前缀长度
    21DA:D3::/48    是一个路由前缀
    21DA:D3:0:2F3B::/64 是一个子网前缀

### 5.10.4 IPv6分组结构与基本报头
1，IPv6 分组结构

    IPv6 分组由一个IPv6报头、多个扩展报头与一个高层协议数据单元组成
    IPv6分组的有效载荷包括扩展报头与高层协议数据
    
    IPv6分组结构
    
            |<-------------------有效载荷-------------------->|            
            |<--------------选项--------------->|
    |基本报头   |  扩展报头  |...| 扩展报头N    |   数据      |
    |<-----------------IPv6数据报-------------->
    
    
    IPv6报头
        每个IPv6分组都有一个IPv6基本报头，基本报头长度固定为40字节
    扩展报头
        IPv6数据包可以没有扩展报头，也可以有一个或多个扩展报头，扩展报头具有不同的长度
    高层协议数据
        高层协议数据单元PDU可以是一个TCP或UDP报文段，也可以是ICMPv6报文
2，IPv6报头的结构与各个字节的意义
    
    IPv6 报头结构
    
        0       4           12      16                      31
    固  |版本   |流量类型    |              流标记          |基
    定  |           载荷长度        |   下一个报头| 跳步限制|本
    长  |                       源地址                      |报
    度  |                       目的地址                    |头
        |                   扩展报头与数据                  |有效载荷
    
    
    版本(version)
    流量类型(traffic class)
    流标记(flow label)
    载荷长度(payload length)
    下一个报头(next header)
    跳步限制(hop limit)

### 5.10.5 IPv4 到 IPv6 过渡的基本方法
1，双IP层或双协议栈
    
    a,双IP层：同时拥有 IPv4协议和IPv6协议，使用隧道技术在两种网络下进行数据传输
    b,双协议栈结构：包含TCP和UDP的不同实现
    
    |   应用层      |       |           应用层              |
    |传输层(TCP/UDP)|       |传输层(TCP/UDP)|传输层(TCP/UDP)|
    |IPv4| |IPv6    |       |   IPv4    |       |   IPv6    |    
    | 主机-网络层   |       |        主机-网络层            |
        
        (a)                               (b)
    
2，隧道技术
      
    通过IPv4隧道传输IPv6分组的机制            
                <-------IPv6分组---------->
               |IPv6分组头|扩展分组头|数据|
    |IPv4分组头|IPv6分组头|扩展分组头|数据|
    <---------------IPv4分组--------------->
    
    
    路由器-路由器隧道
    主机-路由器隧道
    结点-结点隧道
    6over4
    6to4
        一种地址分配和路由器-路由器的自动隧道技术，为IPv6结点之间提供跨越IPv4
        网络的单播IPv6的连通性
        
    ISATAP
        一种地址分配和结点-结点，结点-路由器和路由器-结点的自动隧道协议
        
详情见图 5.66 路由器-路由器隧道结构
5.67 其他隧道结构
## 小结
详情见图 5.70 小结